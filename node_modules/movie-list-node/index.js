const axios = require("axios");
const xlsx = require("xlsx");
const API_KEY = "33b718a0ee66c300e6f3f64c8920bed4";
const excel_dir = "./ExcelFiles/";
var raw;
module.exports.getMovieList = async function (movieOrSeriesName){
   
    var options = {
        method: 'GET',
        url: 'https://api.themoviedb.org/3/search/movie?api_key='+API_KEY+'&query='+movieOrSeriesName
      };

    await axios.request(options).then(function (response) {
       //stringify
       raw = JSON.stringify(response.data.results);
       var files  = []; //declare array
       var obj = JSON.parse(raw); //Parse Json first before mapping
       //Arrange object intro array by mapping
       for(var i in obj)
       files.push(obj[i]);
   
       var newWB = xlsx.utils.book_new(); //Workbook
       var newWS = xlsx.utils.json_to_sheet(files); //Worksheet
       xlsx.utils.book_append_sheet(newWB,newWS,movieOrSeriesName);//workbook name as filename
       xlsx.writeFile(newWB,excel_dir + movieOrSeriesName+ "_list.xlsx");//save to ExcelFiles folder
       console.log("Successfully converted movie data to excel.");
    }).catch(function (error) {
        console.error(error);
    });

};